<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Factory — Посещаемость</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body { background: #eef1f5; }
        .app-shell { background: #eef1f5; }
        .panel { background: #ffffff; border: 1px solid #e5e7eb; border-radius: 14px; box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06); }
        .panel-header { border-bottom: 1px solid #e5e7eb; }
        .toolbar { background: #0b1220; color: #f8fafc; border-radius: 14px; }
        .toolbar-muted { color: #94a3b8; }
        .stat-tile { background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 12px; }
        .data-grid th { background: #f1f5f9; color: #475569; }
        .data-grid td { color: #0f172a; }
        .data-grid tr:hover { background: #f8fafc; }
        .row-late { background: rgba(254, 226, 226, 0.5); }
        .spinner { border: 2px solid #e5e7eb; border-top: 2px solid #0b1220; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-present { background-color: #10B981; color: white; }
        .status-checked-out { background-color: #6B7280; color: white; }
        .status-absent { background-color: #EF4444; color: white; }
        .badge-late { background: #fee2e2; color: #b91c1c; }
        .btn-dark { background-color: #0b1220; color: #fff; }
        .btn-dark:hover { background-color: #0f172a; }
        .btn-outline { border: 1px solid #e2e8f0; color: #0f172a; background: #fff; }
        .btn-outline:hover { background: #f8fafc; }
        .badge-soft { background: #e2e8f0; color: #0f172a; }
        /* Theme overrides */
        .bg-blue-600 { background-color: #0b1220 !important; }
        .hover\:bg-blue-700:hover { background-color: #0f172a !important; }
        .text-blue-600 { color: #0b1220 !important; }
        .bg-blue-50 { background-color: #f1f5f9 !important; }
        .bg-blue-100 { background-color: #e2e8f0 !important; }
        .text-blue-500 { color: #0b1220 !important; }
    </style>
</head>
<body class="min-h-screen" style="font-family: system-ui, -apple-system, sans-serif;">
<div x-data="attendanceDashboard()" x-init="init()">
    {% include 'partials/app_header.html' %}
    {% include 'partials/app_sidebar.html' %}

    <!-- Main Content -->
    <main class="flex-1 overflow-auto md:ml-64 p-4 sm:p-6 mt-16">
        <!-- Toolbar -->
        <div class="toolbar px-6 py-5 mb-6">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-semibold">Посещаемость</h2>
                    <p class="text-sm toolbar-muted">Контроль смен, опозданий и штрафов в реальном времени.</p>
                </div>
                <div class="flex flex-wrap items-center gap-3">
                    <button @click="refreshData()" class="px-4 py-2 rounded-lg btn-outline text-sm">Обновить</button>
                    <button @click="exportData()" class="px-4 py-2 rounded-lg btn-outline text-sm">Экспорт</button>
                    <a href="/attendance/scan/" class="px-4 py-2 rounded-lg btn-dark text-sm">QR-сканер</a>
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3 mt-5">
                <div class="stat-tile p-4">
                    <p class="text-xs text-gray-500">Присутствуют сегодня</p>
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-2xl font-semibold text-green-600" x-text="overview.today?.present || 0"></p>
                        <i data-lucide="users" class="w-5 h-5 text-green-600"></i>
                    </div>
                </div>
                <div class="stat-tile p-4">
                    <p class="text-xs text-gray-500">Ушли сегодня</p>
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-2xl font-semibold text-gray-700" x-text="overview.today?.checked_out || 0"></p>
                        <i data-lucide="log-out" class="w-5 h-5 text-gray-600"></i>
                    </div>
                </div>
                <div class="stat-tile p-4">
                    <p class="text-xs text-gray-500">Опоздали сегодня</p>
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-2xl font-semibold text-red-600" x-text="overview.today?.late || 0"></p>
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-red-600"></i>
                    </div>
                </div>
                <div class="stat-tile p-4">
                    <p class="text-xs text-gray-500">Штрафы сегодня</p>
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-2xl font-semibold text-gray-900" x-text="formatMoney(overview.today?.total_penalties || 0)"></p>
                        <i data-lucide="banknote" class="w-5 h-5 text-gray-700"></i>
                    </div>
                </div>
                <div class="stat-tile p-4">
                    <p class="text-xs text-gray-500">За неделю</p>
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-2xl font-semibold text-blue-600" x-text="overview.week?.attendance || 0"></p>
                        <i data-lucide="calendar" class="w-5 h-5 text-blue-600"></i>
                    </div>
                </div>
                <div class="stat-tile p-4">
                    <p class="text-xs text-gray-500">За месяц</p>
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-2xl font-semibold text-purple-600" x-text="overview.month?.attendance || 0"></p>
                        <i data-lucide="calendar-days" class="w-5 h-5 text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-12 gap-4">
            <div class="col-span-12 xl:col-span-8 space-y-4">
                <div class="panel p-4">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
                        <div>
                            <h3 class="text-base font-semibold text-gray-900">Фильтры</h3>
                            <p class="text-xs text-gray-500">Период, статус и очистка фильтров.</p>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 w-full lg:w-auto">
                            <input type="date" x-model="filters.date_from" @change="loadAttendanceData()" 
                                   class="border border-gray-300 rounded-lg px-3 py-2 text-sm bg-white">
                            <input type="date" x-model="filters.date_to" @change="loadAttendanceData()" 
                                   class="border border-gray-300 rounded-lg px-3 py-2 text-sm bg-white">
                            <select x-model="filters.status" @change="loadAttendanceData()" 
                                    class="border border-gray-300 rounded-lg px-3 py-2 text-sm bg-white">
                                <option value="">Все статусы</option>
                                <option value="present">Присутствуют</option>
                                <option value="checked_out">Ушли</option>
                            </select>
                            <button @click="clearFilters()" 
                                    class="px-4 py-2 text-sm text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                Сбросить
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Attendance Records Table -->
                <div class="panel overflow-hidden">
                    <div class="px-6 py-4 panel-header">
                        <h3 class="text-lg font-semibold text-gray-900">Записи посещаемости</h3>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 data-grid">
                            <thead>
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сотрудник</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Приход</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Уход</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Статус</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Опоздание</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Штраф</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <template x-for="record in attendanceRecords" :key="record.id">
                            <tr class="hover:bg-gray-50" :class="record.is_late ? 'row-late' : ''">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                            <span class="text-blue-600 text-sm font-medium" x-text="record.employee.avatar"></span>
                                        </div>
                                        <span class="text-sm font-medium text-gray-900" x-text="record.employee.name"></span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="formatDate(record.date)"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="formatTime(record.check_in)"></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="record.check_out ? formatTime(record.check_out) : '-'"></td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full" 
                                          :class="getStatusClass(record.status)"
                                          x-text="getStatusText(record.status)"></span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span x-show="record.is_late" class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full badge-late">
                                        <i data-lucide="alert-triangle" class="w-3 h-3 mr-1"></i>
                                        Опоздание
                                    </span>
                                    <span x-show="!record.is_late" class="text-sm text-gray-400">-</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    <div class="flex items-center gap-2">
                                        <template x-if="isAdmin && editingPenaltyId === record.id">
                                            <div class="flex items-center gap-2">
                                                <input type="number" min="0" step="0.01" x-model="penaltyDraft"
                                                       class="w-24 border border-gray-300 rounded-md px-2 py-1 text-xs">
                                                <button @click="savePenalty(record)" class="px-2 py-1 text-xs btn-dark rounded-md">OK</button>
                                                <button @click="cancelPenaltyEdit()" class="px-2 py-1 text-xs btn-outline rounded-md">Отмена</button>
                                            </div>
                                        </template>
                                        <template x-if="!isAdmin || editingPenaltyId !== record.id">
                                            <div class="flex items-center gap-2">
                                                <span x-text="record.penalty_amount ? formatMoney(record.penalty_amount) : '-'"></span>
                                                <button x-show="isAdmin" @click="startPenaltyEdit(record)" class="text-xs text-blue-600 hover:text-blue-800">Изм.</button>
                                            </div>
                                        </template>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button x-show="record.status === 'present'" 
                                            @click="checkoutEmployee(record.employee.id)"
                                            class="text-blue-600 hover:text-blue-900 transition-colors">
                                        Отметить уход
                                    </button>
                                    <span x-show="record.status === 'checked_out'" class="text-gray-500">Завершено</span>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                        </table>
                        
                        <!-- Loading State -->
                        <div x-show="loading" class="text-center py-8">
                            <div class="flex items-center justify-center space-x-2">
                                <div class="spinner"></div>
                                <span class="text-gray-600">Загрузка...</span>
                            </div>
                        </div>
                        
                        <!-- Empty State -->
                        <div x-show="!loading && attendanceRecords.length === 0" class="text-center py-8 text-gray-500">
                            <p class="text-sm">Нет записей о посещаемости</p>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <div x-show="pagination.pages > 1" class="px-6 py-4 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-gray-700">
                                Показано <span x-text="(pagination.page - 1) * pagination.per_page + 1"></span> - 
                                <span x-text="Math.min(pagination.page * pagination.per_page, pagination.total)"></span> 
                                из <span x-text="pagination.total"></span> записей
                            </div>
                            <div class="flex space-x-2">
                                <button x-show="pagination.page > 1" 
                                        @click="changePage(pagination.page - 1)"
                                        class="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Назад
                                </button>
                                <span class="px-3 py-1 text-sm text-gray-700">
                                    Страница <span x-text="pagination.page"></span> из <span x-text="pagination.pages"></span>
                                </span>
                                <button x-show="pagination.page < pagination.pages" 
                                        @click="changePage(pagination.page + 1)"
                                        class="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Вперед
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-span-12 xl:col-span-4 space-y-4">
                <div class="panel p-5">
                    <h3 class="text-base font-semibold text-gray-900 mb-4">Топ сотрудников</h3>
                    <div class="space-y-3">
                        <template x-for="emp in overview.top_employees" :key="emp.id">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-blue-600 text-sm font-medium" x-text="emp.avatar"></span>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900" x-text="emp.name"></span>
                                </div>
                                <span class="text-sm text-gray-600" x-text="emp.attendance_count + ' дней'"></span>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="panel p-5">
                    <h3 class="text-base font-semibold text-gray-900 mb-4">Быстрые действия</h3>
                    <div class="space-y-3">
                        <button @click="refreshData()" class="w-full flex items-center justify-between p-3 btn-outline rounded-lg text-sm">
                            <span>Обновить данные</span>
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        </button>
                        <button @click="exportData()" class="w-full flex items-center justify-between p-3 btn-outline rounded-lg text-sm">
                            <span>Экспорт Excel</span>
                            <i data-lucide="download" class="w-4 h-4"></i>
                        </button>
                        <a href="/attendance/scan/" class="w-full flex items-center justify-between p-3 btn-dark rounded-lg text-sm">
                            <span>Открыть QR-сканер</span>
                            <i data-lucide="qr-code" class="w-4 h-4"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    function attendanceDashboard() {
        return {
            overview: {},
            attendanceRecords: [],
            pagination: {
                page: 1,
                per_page: 20,
                total: 0,
                pages: 0
            },
            filters: {
                date_from: '',
                date_to: '',
                status: ''
            },
            isAdmin: "{{ request.user.role }}" === "admin",
            editingPenaltyId: null,
            penaltyDraft: '',
            loading: false,

            async init() {
                await this.loadOverviewData();
                await this.loadAttendanceData();
                lucide.createIcons();
                this.$nextTick(() => {
                    lucide.createIcons();
                });
            },

            async loadOverviewData() {
                try {
                    const response = await fetch('/attendance/api/overview/');
                    if (response.ok) {
                        this.overview = await response.json();
                    }
                } catch (e) {
                    console.error('Ошибка загрузки обзора:', e);
                }
            },

            async loadAttendanceData() {
                try {
                    this.loading = true;
                    
                    const params = new URLSearchParams({
                        page: this.pagination.page,
                        per_page: this.pagination.per_page
                    });
                    
                    if (this.filters.date_from) params.append('date_from', this.filters.date_from);
                    if (this.filters.date_to) params.append('date_to', this.filters.date_to);
                    if (this.filters.status) params.append('status', this.filters.status);
                    
                    const response = await fetch(`/attendance/api/list/?${params}`);
                    if (response.ok) {
                        const data = await response.json();
                        this.attendanceRecords = data.records;
                        this.pagination = data.pagination;
                    }
                } catch (e) {
                    console.error('Ошибка загрузки данных:', e);
                } finally {
                    this.loading = false;
                }
            },

            async checkoutEmployee(employeeId) {
                try {
                    const response = await fetch('/attendance/api/checkout/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': this.getCsrfToken()
                        },
                        body: JSON.stringify({ employee_id: employeeId })
                    });
                    
                    if (response.ok) {
                        await this.loadAttendanceData();
                        await this.loadOverviewData();
                    }
                } catch (e) {
                    console.error('Ошибка отметки ухода:', e);
                }
            },

            async refreshData() {
                await Promise.all([
                    this.loadOverviewData(),
                    this.loadAttendanceData()
                ]);
            },

            startPenaltyEdit(record) {
                this.editingPenaltyId = record.id;
                this.penaltyDraft = record.penalty_amount || 0;
            },

            cancelPenaltyEdit() {
                this.editingPenaltyId = null;
                this.penaltyDraft = '';
            },

            async savePenalty(record) {
                const amount = Number(String(this.penaltyDraft).replace(',', '.'));
                if (Number.isNaN(amount) || amount < 0) {
                    alert('Введите корректную сумму штрафа.');
                    return;
                }
                try {
                    const response = await fetch('/attendance/api/penalty/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': this.getCsrfToken()
                        },
                        body: JSON.stringify({ record_id: record.id, penalty_amount: amount })
                    });
                    const data = await response.json();
                    if (!response.ok) {
                        throw new Error(data.error || 'Ошибка сохранения штрафа');
                    }
                    record.penalty_amount = data.penalty_amount;
                    this.cancelPenaltyEdit();
                } catch (e) {
                    alert(e.message || 'Ошибка сохранения штрафа');
                }
            },

            changePage(page) {
                this.pagination.page = page;
                this.loadAttendanceData();
            },

            clearFilters() {
                this.filters = {
                    date_from: '',
                    date_to: '',
                    status: ''
                };
                this.pagination.page = 1;
                this.loadAttendanceData();
            },

            exportData() {
                // Создаем красивый Excel файл
                this.createExcelFile();
            },

            createExcelFile() {
                try {
                    // Создаем новую книгу Excel
                    const wb = XLSX.utils.book_new();
                    
                    // Данные для основного листа
                    const mainData = [
                        // Заголовок отчета
                        ['Отчет по посещаемости - Smart Factory'],
                        [''],
                        ['Статистика:'],
                        [`Присутствуют сегодня: ${this.overview.today?.present || 0} чел.`, `Ушли сегодня: ${this.overview.today?.checked_out || 0} чел.`],
                        [`За неделю: ${this.overview.week?.attendance || 0} записей`, `За месяц: ${this.overview.month?.attendance || 0} записей`],
                        [''],
                        // Заголовки таблицы
                        ['Сотрудник', 'Дата', 'Время прихода', 'Время ухода', 'Статус', 'Опоздание', 'Штраф', 'Примечание'],
                        // Данные записей
                        ...this.attendanceRecords.map(record => [
                            record.employee.name,
                            this.formatDate(record.date),
                            this.formatTime(record.check_in),
                            record.check_out ? this.formatTime(record.check_out) : '-',
                            this.getStatusText(record.status),
                            record.is_late ? 'Да' : 'Нет',
                            record.penalty_amount ? this.formatMoney(record.penalty_amount) : '-',
                            record.note || '-'
                        ])
                    ];
                    
                    // Создаем лист с данными
                    const ws = XLSX.utils.aoa_to_sheet(mainData);
                    
                    // Настраиваем стили и форматирование
                    ws['!cols'] = [
                        { width: 25 }, // Сотрудник
                        { width: 15 }, // Дата
                        { width: 15 }, // Время прихода
                        { width: 15 }, // Время ухода
                        { width: 15 }, // Статус
                        { width: 12 }, // Опоздание
                        { width: 15 }, // Штраф
                        { width: 20 }  // Примечание
                    ];
                    
                    // Добавляем лист в книгу
                    XLSX.utils.book_append_sheet(wb, ws, 'Посещаемость');
                    
                    // Создаем лист со статистикой
                    const statsData = [
                        ['Топ сотрудников по посещаемости'],
                        [''],
                        ['Место', 'Сотрудник', 'Дней посещения'],
                        ...(this.overview.top_employees || []).map((emp, index) => [
                            index + 1,
                            emp.name,
                            emp.attendance_count
                        ]),
                        [''],
                        ['Общая статистика'],
                        ['Всего сотрудников', this.overview.today?.total_employees || 0],
                        ['Присутствуют сегодня', this.overview.today?.present || 0],
                        ['Ушли сегодня', this.overview.today?.checked_out || 0],
                        ['Записей за неделю', this.overview.week?.attendance || 0],
                        ['Записей за месяц', this.overview.month?.attendance || 0],
                        [''],
                        ['Отчет сгенерирован:', new Date().toLocaleString('ru-RU')]
                    ];
                    
                    const statsWs = XLSX.utils.aoa_to_sheet(statsData);
                    statsWs['!cols'] = [
                        { width: 15 }, // Место
                        { width: 30 }, // Сотрудник
                        { width: 20 }  // Дней посещения
                    ];
                    
                    XLSX.utils.book_append_sheet(wb, statsWs, 'Статистика');
                    
                    // Создаем лист с фильтрами
                    const filtersData = [
                        ['Примененные фильтры'],
                        [''],
                        ['Параметр', 'Значение'],
                        ['Дата с', this.filters.date_from || 'Не указано'],
                        ['Дата по', this.filters.date_to || 'Не указано'],
                        ['Статус', this.filters.status ? this.getStatusText(this.filters.status) : 'Все'],
                        [''],
                        ['Всего записей в выборке:', this.pagination.total],
                        ['Текущая страница:', this.pagination.page],
                        ['Записей на странице:', this.pagination.per_page]
                    ];
                    
                    const filtersWs = XLSX.utils.aoa_to_sheet(filtersData);
                    filtersWs['!cols'] = [
                        { width: 25 }, // Параметр
                        { width: 30 }  // Значение
                    ];
                    
                    XLSX.utils.book_append_sheet(wb, filtersWs, 'Фильтры');
                    
                    // Генерируем файл
                    const fileName = `attendance_report_${new Date().toISOString().split('T')[0]}.xlsx`;
                    XLSX.writeFile(wb, fileName);
                    
                } catch (error) {
                    console.error('Ошибка при создании Excel файла:', error);
                    alert('Ошибка при создании Excel файла. Попробуйте еще раз.');
                }
            },

            getCsrfToken() {
                return document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
            },

            formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('ru-RU');
            },

            formatTime(timeString) {
                if (!timeString) return '';
                const time = new Date(timeString);
                return time.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            },

            formatMoney(value) {
                const amount = Number(value || 0);
                return amount.toLocaleString('ru-RU') + ' сом';
            },

            getStatusClass(status) {
                const statusClasses = {
                    'present': 'status-present',
                    'checked_out': 'status-checked-out',
                    'absent': 'status-absent'
                };
                return statusClasses[status] || 'bg-gray-100 text-gray-800';
            },

            getStatusText(status) {
                const statusTexts = {
                    'present': 'Присутствует',
                    'checked_out': 'Ушел',
                    'absent': 'Отсутствует'
                };
                return statusTexts[status] || 'Неизвестно';
            }
        }
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
    });
</script>
</body>
</html> 
