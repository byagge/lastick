<aside class="fixed top-16 left-0 bottom-0 w-64 bg-white/85 backdrop-blur border-r border-gray-200/70 shadow-sm">
  <div class="h-full flex flex-col">
    <div class="px-4 pt-5 pb-4 border-b border-gray-200/70">
      <div class="flex items-center gap-3 px-3 py-2 rounded-xl bg-gray-900 text-white">
        <span class="w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center">
          <i data-lucide="layers" class="w-4 h-4"></i>
        </span>
        <div>
          <p class="text-sm font-semibold leading-tight">lastick</p>
          <p class="text-xs text-white/70">Операционная панель</p>
        </div>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto px-3 py-4 app-scrollbar">
      <div class="relative">
        <button id="sidebarModeToggle" type="button" class="w-full flex items-center justify-between px-3 py-2 rounded-lg border border-gray-200 hover:bg-gray-50">
          <span class="flex items-center gap-2 text-sm font-medium text-gray-800">
            <span class="w-7 h-7 rounded-lg bg-blue-50 text-blue-700 flex items-center justify-center">
              <i data-lucide="grid-2x2" class="w-4 h-4"></i>
            </span>
            <span id="sidebarModeLabel">Операционная</span>
          </span>
          <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
        </button>
        <div id="sidebarModeMenu" class="hidden absolute left-0 right-0 mt-2 bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden z-20">
          <button type="button" data-mode="operational" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Операционная</button>
          <button type="button" data-mode="finance" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Финансовая</button>
        </div>
      </div>

      <div class="mt-4" data-sidebar-section="operational">
        <p class="px-3 text-xs font-semibold uppercase tracking-wider text-gray-400">Операционная</p>
        <nav class="mt-3 space-y-1">
          <a href="/dashboard/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="layout-grid" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Дашборд
          </a>
          <a href="/orders/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="clipboard-list" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Заказы
          </a>
          <a href="/products/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="package" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Продукция
          </a>
          <a href="/finished_goods/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="box" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Готовая продукция
          </a>
          <a href="/inventory/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="layers-3" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Склад
          </a>
          <a href="/workshops/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="warehouse" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Цеха
          </a>
          <a href="/employees/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="users" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Сотрудники
          </a>
          <a href="/attendance/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="clock-3" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Посещаемость
          </a>
          <a href="/defects/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="alert-triangle" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Браки
          </a>
          <a href="/clients/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="user-plus" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Клиенты
          </a>
        </nav>
      </div>

      <div class="mt-4 hidden" data-sidebar-section="finance">
        <p class="px-3 text-xs font-semibold uppercase tracking-wider text-gray-400">Финансы</p>
        <nav class="mt-3 space-y-1">
          <a href="/finance/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="pie-chart" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Финансовая панель
          </a>
          <a href="/finance/expenses/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="receipt" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Расходы
          </a>
          <a href="/finance/incomes/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="trending-up" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Доходы
          </a>
          <a href="/finance/debts/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="scale" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Долги
          </a>
          <a href="/finance/financial-reports/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="bar-chart-3" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Отчеты
          </a>
          <!-- <a href="/finance/accounts/" class="group flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-700 hover:bg-gray-50">
            <i data-lucide="wallet" class="w-4 h-4 text-gray-400 group-hover:text-gray-700"></i>
            Счета
          </a> -->
        </nav>
      </div>
    </div>

    <div class="px-4 py-4 border-t border-gray-200/70">
      <div class="flex items-center gap-3">
        <span class="w-11 h-11 rounded-full bg-gradient-to-br from-gray-900 via-gray-800 to-gray-700 text-white text-sm font-semibold flex items-center justify-center shadow-sm">
          {{ request.user.get_full_name|default:request.user.username|slice:":2"|upper }}
        </span>
        <div class="min-w-0">
          <p class="text-sm font-semibold text-gray-900 truncate">
            {{ request.user.get_full_name|default:request.user.username }}
          </p>
          <p class="text-xs text-gray-500 truncate">{{ request.user.email|default:"—" }}</p>
        </div>
      </div>
    </div>
  </div>
</aside>
<script>
  (function () {
    var toggle = document.getElementById('sidebarModeToggle');
    var menu = document.getElementById('sidebarModeMenu');
    var label = document.getElementById('sidebarModeLabel');
    var sections = document.querySelectorAll('[data-sidebar-section]');
    var storageKey = 'lastickSidebarMode';
    var defaultMode = 'operational';

    if (!toggle || !menu || !label || !sections.length) {
      return;
    }

    function getLabelForMode(mode) {
      var btn = menu.querySelector('[data-mode="' + mode + '"]');
      return btn ? btn.textContent.trim() : '';
    }

    function setMode(mode) {
      sections.forEach(function (section) {
        section.classList.toggle('hidden', section.getAttribute('data-sidebar-section') !== mode);
      });
      var text = getLabelForMode(mode) || getLabelForMode(defaultMode);
      if (text) {
        label.textContent = text;
      }
      menu.classList.add('hidden');
      try {
        localStorage.setItem(storageKey, mode);
      } catch (e) {}
    }

    toggle.addEventListener('click', function () {
      menu.classList.toggle('hidden');
    });

    menu.addEventListener('click', function (event) {
      var btn = event.target.closest('[data-mode]');
      if (!btn) return;
      var mode = btn.getAttribute('data-mode');
      setMode(mode);
    });

    document.addEventListener('click', function (event) {
      if (!menu.contains(event.target) && !toggle.contains(event.target)) {
        menu.classList.add('hidden');
      }
    });

    var storedMode = null;
    try {
      storedMode = localStorage.getItem(storageKey);
    } catch (e) {}
    setMode(storedMode || defaultMode);
  })();
</script>
